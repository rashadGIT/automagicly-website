AutoMagicly - Test Environment Using Production Configuration
==============================================================

âš ï¸  IMPORTANT: This configures test.automagicly.ai to use the SAME n8n
    webhooks as production (not separate /webhook-test/ endpoints)

Copy and paste these into AWS Amplify Console â†’ Environment variables
for the TEST BRANCH

Go to: AWS Amplify Console â†’ Your App â†’ test branch â†’ Environment variables

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

N8N WEBHOOK URLS (Public - Browser-side)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  Using PRODUCTION /webhook/ endpoints (shared with production)

NEXT_PUBLIC_N8N_AUDIT_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/booking

NEXT_PUBLIC_N8N_REVIEWS_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/reviews

NEXT_PUBLIC_N8N_REFERRALS_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/referrals

NEXT_PUBLIC_N8N_WAITLIST_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/waitlist

NEXT_PUBLIC_N8N_AUDIT_AI_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/audit-ai

NEXT_PUBLIC_N8N_REVIEW_GENERATOR_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/review-generator


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CHAT ASSISTANT (Server-side only, NOT public)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  Using PRODUCTION /webhook/ endpoints (shared with production)

N8N_CHAT_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/chat

N8N_CHAT_API_KEY
9e9b75e99e1883418181ed35b3cc61a4594cd768022a49d8e65eee36d738071b

N8N_AUDIT_AI_API_KEY
âš ï¸  Copy from your .env.production file

N8N_AUDIT_EMAIL_WEBHOOK_URL
https://rashadbarnett.app.n8n.cloud/webhook/audit-email-results


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

NEXTAUTH CONFIGURATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  IMPORTANT: These MUST be different for test vs production

NEXTAUTH_URL
https://test.automagicly.ai

NEXTAUTH_SECRET
âš ï¸  MUST BE DIFFERENT from production! Generate with:
    openssl rand -base64 32


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

GOOGLE CALENDAR API (Shared with Production)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

GOOGLE_SERVICE_ACCOUNT_EMAIL
automagicly-calendar-reader@automagicly.iam.gserviceaccount.com

GOOGLE_CALENDAR_ID
43b775854c475d11df8d6850be20324ab6d73d82eb7c43b4fc6277a6ebeeb6d1@group.calendar.google.com

GOOGLE_PRIVATE_KEY
âš ï¸  Copy the entire private key from your .env.production file including:
-----BEGIN PRIVATE KEY----- and -----END PRIVATE KEY----- lines
(paste exactly as it appears with \n characters intact)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SUPABASE (Shared with Production)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

NEXT_PUBLIC_SUPABASE_URL
https://niuadokiehxkethhrhtp.supabase.co

NEXT_PUBLIC_SUPABASE_ANON_KEY
âš ï¸  Copy from your .env.production file

SUPABASE_SERVICE_ROLE_KEY
âš ï¸  Copy from your .env.production file


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DYNAMODB (Shared with Production)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DB_ACCESS_KEY_ID
âš ï¸  Copy from your .env.production file

DB_SECRET_ACCESS_KEY
âš ï¸  Copy from your .env.production file

REGION
us-east-1


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ADMIN ACCESS (Shared with Production)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

NEXT_PUBLIC_ADMIN_PASSWORD
âš ï¸  Can be same as production or different (your choice)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CLOUDWATCH RUM (Optional - Production Monitoring)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

If you have CloudWatch RUM configured in production, copy these:

NEXT_PUBLIC_RUM_APP_ID
âš ï¸  Copy from production if using RUM

NEXT_PUBLIC_RUM_IDENTITY_POOL_ID
âš ï¸  Copy from production if using RUM

NEXT_PUBLIC_RUM_REGION
âš ï¸  Copy from production if using RUM

NEXT_PUBLIC_ENABLE_RUM
true


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

STEP-BY-STEP INSTRUCTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Open .env.production file locally (contains your secret values)

2. Go to AWS Amplify Console:
   - Navigate to your app
   - Click on "test" branch in left sidebar
   - Click "Environment variables"
   - Click "Manage variables"

3. For each variable above:
   - If marked with âš ï¸  "Copy from .env.production":
     * Find the variable in your .env.production file
     * Copy the actual value
     * Paste into Amplify

   - If the value is shown (like n8n URLs):
     * Copy exactly as shown

4. CRITICAL - These MUST be different for test:
   - NEXTAUTH_URL: https://test.automagicly.ai (not automagicly.ai)
   - NEXTAUTH_SECRET: Generate new with: openssl rand -base64 32

5. Click "Save" when done

6. Amplify will automatically redeploy the test branch


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

VERIFICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

After deployment completes:

1. Visit: https://test.automagicly.ai/api/debug-n8n

   Should show:
   {
     "pathCheck": {
       "chatUsesTest": false,  âœ… Using production endpoints
       "chatUsesProd": true,   âœ… Using production endpoints
       "auditUsesTest": false  âœ… Using production endpoints
     },
     "serverWebhooks": {
       "chat": "SET",          âœ… Webhook configured
       "chatUrl": "SET"        âœ… URL set
     },
     "apiKeys": {
       "chatApiKey": "SET"     âœ… API key set
     }
   }

2. Test features at https://test.automagicly.ai:
   - Chat widget â†’ should work
   - AI Business Audit â†’ should work
   - Custom booking â†’ should work
   - Reviews form â†’ should work

3. Check browser DevTools â†’ Network tab:
   - All n8n requests should return 200 OK
   - No 404, 401, or CORS errors


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IMPORTANT NOTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸  Test and Production will share:
    - Same n8n workflows (/webhook/ endpoints)
    - Same database (DynamoDB)
    - Same Google Calendar
    - Same Supabase instance

âœ…  This means:
    - Test data will appear in production database
    - Test bookings will appear in production calendar
    - Test reviews will be stored alongside production reviews

ğŸ’¡  If you want test isolation:
    - Use /webhook-test/ endpoints for test environment
    - See: ENVIRONMENT_VARIABLES_TEST.txt

ğŸ”’  Security:
    - NEXTAUTH_SECRET must be different for test and production
    - This prevents session token replay attacks between environments


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

QUICK COPY CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â–¡ All NEXT_PUBLIC_N8N_* URLs (use /webhook/ not /webhook-test/)
â–¡ N8N_CHAT_WEBHOOK_URL (use /webhook/chat)
â–¡ N8N_CHAT_API_KEY
â–¡ N8N_AUDIT_AI_API_KEY
â–¡ N8N_AUDIT_EMAIL_WEBHOOK_URL
â–¡ NEXTAUTH_URL = https://test.automagicly.ai
â–¡ NEXTAUTH_SECRET (generate new, don't copy from production!)
â–¡ GOOGLE_SERVICE_ACCOUNT_EMAIL
â–¡ GOOGLE_CALENDAR_ID
â–¡ GOOGLE_PRIVATE_KEY (with \n characters)
â–¡ NEXT_PUBLIC_SUPABASE_URL
â–¡ NEXT_PUBLIC_SUPABASE_ANON_KEY
â–¡ SUPABASE_SERVICE_ROLE_KEY
â–¡ DB_ACCESS_KEY_ID
â–¡ DB_SECRET_ACCESS_KEY
â–¡ REGION
â–¡ NEXT_PUBLIC_ADMIN_PASSWORD
â–¡ CloudWatch RUM variables (if using)

After adding all variables â†’ Save â†’ Wait for auto-deployment â†’ Test!
